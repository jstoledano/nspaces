/*
* xeMusicPlayer Version 1.0.0
*
* Copyright 2013 @xeonne.de
* Licensed under the BSD license.
*/
(function(h){h.fn.xeMusicPlayer=function(f){function m(b){a.find(".xeBar").addClass("loader");if(e.length>b){if(""!=d.canPlayType("audio/mpeg")&&void 0!=e[b].mp3)d.src=e[b].mp3,d.load();else if(""!=d.canPlayType("audio/ogg")&&void 0!=e[b].ogg)d.src=e[b].ogg,d.load();else{console.log("xeMusicPlayer-Error","Can't play MPEG or OGG data!");return}void 0!=e[b].title?a.find(".xeTitle").text(e[b].title):a.find(".xeTitle").text("");a.find(".xeTitleLink").wrap(a.find(".xeTitle"));a.find(".xeTitleLink").remove();
void 0!=e[b].title_link&&a.find(".xeTitle").wrap("<a href='"+e[b].title_link+"' class='xeTitleLink'></a>");void 0!=e[b].artist?a.find(".xeTitleBy").text(e[b].artist):a.find(".xeTitleBy").text("");a.find(".xeTitleByLink").wrap(a.find(".xeTitleBy"));a.find(".xeTitleByLink").remove();void 0!=e[b].artist_link&&a.find(".xeTitleBy").wrap("<a href='"+e[b].title_link+"' class='xeTitleByLink'></a>");void 0!=e[b].cover?a.find(".xeCover img").attr("src",e[b].cover):a.find(".xeCover img").attr("src","xeMusicPlayer/img/cover-none.png")}c.onChangeSongIndex.call(this)}
function q(){if(void 0!=d.currentTime&&d.currentTime!=isNaN()){n=d.currentTime;var b=n/60,b=b.toFixed(2);-1==b.indexOf(".")&&(b+=".00");var b=b.split("."),c=Math.ceil(60*(b[1]/100));60==c&&(++b[0],c=0);a.find(".xeTime > p").text(b[0]+":"+(10>c?"0"+c:c));b=100*n/j;a.find(".xeBarTime").width(b/100*k)}else a.find(".xeTime > p").text("0:00"),h(".xeBarTime").width(0)}function t(){!0==c.isPlaying?(a.find(".xePlay").removeClass("xeStop"),d.pause(),null!=g&&(window.clearInterval(g),g=null),c.onClickPause.call(this)):
(a.find(".xePlay").addClass("xeStop"),d.play(),null==g&&(g=window.setInterval(function(){q()},50)),c.onClickPlay.call(this));c.onChangePlaying.call(this)}function r(){c.songindex+1<e.length&&(m(++c.songindex),a.find(".xePrevious").removeClass("disabled"));c.songindex+1>=e.length&&a.find(".xeNext").addClass("disabled")}var c=h.extend({},h.fn.xeMusicPlayer.options,f);h.fn.xeMusicPlayer.options=c;var e=c.songlist;f=c.mode;var a=h(this),l=c.theme,d=null,j=0,n=0,g=null,k,s,p=1;1==l?1==f?a.html('<div class="xeMusic xeMusicPlayer"><div class="xeHeader"><div class="xeCover"><img src="xeMusicPlayer/img/cover-none.png" alt="" width="80" /></div><div class="xeMusicHeader"><div class="xeMusicHeaderText"><p class="xeTitle"></p><p class="xeTitleBy"></p></div><div class="xeSidebar"><div class="xeSidebarIcon xeTooltip"><span class="xeSidebarError"></span></div></div></div></div><div class="xePlayer"><div class="xeButton"><ul><li class="xePrevious disabled"><a href="javascript:;"></a></li><li class="xePlay"><a href="javascript:;"></a></li><li class="xeNext"><a href="javascript:;"></a></li></ul></div><div class="xeBar"><div class="xeBarTime"></div></div><div class="xeTime"><p>0:00</p></div></div><audio class="xeMP3"></audio></div>'):
2==f&&a.html('<div class="xeMusic xeMusicPlayer xeMode2"> <div class="xeHeader"> <div class="xeCover"> <img src="xeMusicPlayer/img/cover-none.png" alt="" width="80" /> </div> <div class="xeMusicHeader"> <div class="xeMusicHeaderText"> <p class="xeTitle"></p> <p class="xeTitleBy"></p> </div> <div class="xeSidebar"> <div class="xeSidebarIcon xeTooltip"> <span class="xeSidebarError"></span> </div> </div> </div> </div> <div class="xePlayer"> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> <div class="xeBar"> <div class="xeBarTime"></div> </div> <div class="xeTime"> <p>0:00</p> </div> <div class="xeVolume"> <ul> <li class="xeVolumeIcon xeVolumeOn"><a href="javascript:;"></a></li> </ul> </div> <div class="xeBarVolume"> <div class="xeBarVolumeLine"></div> </div> </div> <audio class="xeMP3"></audio> </div>'):
2==l?1==f?a.html('<div class="xeMusic xeMusicPlayer2"> <div class="xeHeader"> <div class="xeCover"> <img src="songs/Joe_Marson__The_Satisfied_Mind_-_09_-_Poor_St_John.jpg" alt="" width="31" /> </div> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> </div> <div class="xePlayer"> <div class="xeBar"> <div class="xeBarTime"></div> </div> <div class="xeTime"> <p>0:00</p> </div> </div> <audio class="xeMP3"></audio> </div>'):
2==f&&a.html('<div class="xeMusic xeMusicPlayer2 xeMode2"> <div class="xeHeader"> <div class="xeCover"> <img src="songs/Joe_Marson__The_Satisfied_Mind_-_09_-_Poor_St_John.jpg" alt="" width="31" /> </div> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> </div> <div class="xePlayer"> <div class="xeBar"> <div class="xeBarTime"></div> </div> <div class="xeTime"> <p>0:00</p> </div> <div class="xeVolume"> <ul> <li class="xeVolumeIcon xeVolumeOn"> <a href="javascript:;"></a> </li> </ul> </div> </div> <audio class="xeMP3"></audio> </div>'):
3==l?1==f?a.html('<div class="xeMusic xeMusicPlayer3"> <div class="xePlayer"> <div class="xeBarWithTime"> <div class="xeBar"> <div class="xeBarTime"></div> </div> </div> <div class="xeButtonWithVolume"> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> <div class="xeTime"><p>0:00</p></div> </div> </div> <div class="xeHeader"> <div class="xeCover"> <img src="" alt="" width="70" /> </div> <div class="xeMusicHeader"> <div class="xeMusicHeaderText"> <p class="xeTitle"></p> <p class="xeTitleBy"></p> </div> </div> </div> <audio class="xeMP3"></audio> </div>'):
2==f&&a.html('<div class="xeMusic xeMusicPlayer3 xeMode2"> <div class="xePlayer"> <div class="xeBarWithTime"> <div class="xeBar"> <div class="xeBarTime"></div> </div> </div> <div class="xeButtonWithVolume"> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> <div class="xeVolume"> <ul> <li class="xeVolumeIcon xeVolumeOn"> <a href="javascript:;"></a> </li> </ul> </div> <div class="xeTime"><p>0:00</p></div> </div> </div> <div class="xeHeader"> <div class="xeCover"> <img src="" alt="" width="70" /> </div> <div class="xeMusicHeader"> <div class="xeMusicHeaderText"> <p class="xeTitle"></p> <p class="xeTitleBy"></p> </div> </div> </div> <audio class="xeMP3"></audio> </div>'):
4==l&&(1==f?a.html('<div class="xeMusic xeMusicPlayer4"> <div class="xeCover"> <img src="" alt="" width="250" /> </div> <div class="xePlayer"> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> <div class="xeBar"> <div class="xeBarTime"></div> </div> <div class="xeTime"><p>0:00</p></div> <div class="xeHeader"> <div class="xeMusicHeaderText"> <p class="xeTitle"></p> <p class="xeTitleBy"></p> </div> </div> </div> <audio class="xeMP3"></audio> </div>'):
2==f&&a.html('<div class="xeMusic xeMusicPlayer4 xeMode2"> <div class="xeCover"> <img src="" alt="" width="250" /> </div> <div class="xePlayer"> <div class="xeVolume"> <ul> <li class="xeVolumeIcon xeVolumeOn"> <a href="javascript:;"></a> </li> </ul> </div> <div class="xeButton"> <ul> <li class="xePrevious disabled"><a href="javascript:;"></a></li> <li class="xePlay"><a href="javascript:;"></a></li> <li class="xeNext"><a href="javascript:;"></a></li> </ul> </div> <div class="xeBar"> <div class="xeBarTime"></div> </div> <div class="xeTime"><p>0:00</p></div> <div class="xeHeader"> <div class="xeMusicHeaderText"> <p class="xeTitle"></p> <p class="xeTitleBy"></p> </div> </div> </div> <audio class="xeMP3"></audio> </div>'));
d=a.find(".xeMP3")[0];k=a.find(".xeBarTime").width();s=a.find(".xeBarVolumeLine").width();a.find(".xeBarTime").width(0);d.addEventListener("abort",function(){a.find(".xeSidebar").show();a.find(".xeSidebarError").text("The loading of an audio is aborted!")});d.addEventListener("stalled",function(){a.find(".xeSidebar").show();a.find(".xeSidebarError").text("Browser is trying to get media data, but data is not available!")});d.addEventListener("play",function(){c.isPlaying=!0});d.addEventListener("error",
function(a){console.log("xeMusicPlayer-Error",a)});d.addEventListener("pause",function(){c.isPlaying=!1});d.addEventListener("ended",function(){r();c.isPlaying=!0});d.addEventListener("volumechange",function(){a.find(".xeBarVolumeLine").width(s/(100/(100*c.volume)));a.find(".xeVolumeIcon").removeClass("xeVolumeMute");a.find(".xeVolumeIcon").removeClass("xeVolumeOn");0==c.volume?a.find(".xeVolumeIcon").addClass("xeVolumeMute"):a.find(".xeVolumeIcon").addClass("xeVolumeOn");c.onChangeVolume.call(this)});
d.addEventListener("loadedmetadata",function(){a.find(".xeBarTime").width(0);a.find(".xeSidebar").hide();if(void 0!=d.duration&&d.duration!=isNaN()){j=d.duration;var b=j/60,b=b.toFixed(2);-1==b.indexOf(".")&&(b+=".00");var b=b.split("."),e=Math.ceil(60*(b[1]/100));a.find(".xeTime > p").text(b[0]+":"+(10>e?"0"+e:e))}else a.find(".xeTime > p").text("-:--");!0==c.isPlaying?(d.play(),null==g&&(g=window.setInterval(function(){q()},50))):(d.pause(),null!=g&&(window.clearInterval(g),g=null));a.find(".xeBar").removeClass("loader")});
a.find(".xePlay").click(function(){t()});a.find(".xeNext").click(function(){r();c.onClickNext.call(this)});a.find(".xePrevious").click(function(){0<=c.songindex-1&&(m(--c.songindex),a.find(".xeNext").removeClass("disabled"));0>=c.songindex&&a.find(".xePrevious").addClass("disabled");c.onClickPrev.call(this)});a.find(".xeVolumeIcon").click(function(){d.muted?(d.muted=!1,d.volume=p,c.volume=p):(d.muted=!0,d.volume=0,p=c.volume,c.volume=0)});a.find(".xeBar").click(function(a){var c=h(a.target).offset();
d.currentTime=j/100*100*((a.pageX-c.left)/k)});a.find(".xeBarVolume").click(function(a){var e=h(a.target).offset();d.volume=j/100*100*((a.pageX-e.left)/k)/100;c.volume=d.volume});m(c.songindex)};h.fn.xeMusicPlayer.options={songlist:[],mode:1,theme:1,sync:!1,onClickPlay:function(){},onClickPause:function(){},onClickPrev:function(){},onClickNext:function(){},onChangeVolume:function(){},onChangePlaying:function(){},onChangeSongIndex:function(){},songindex:0,volume:1,isPlaying:!1}})(jQuery);